## 1. Выбор темы
Tinder - location-based social search

## 2. Определение возможного диапазона нагрузок подобного проекта

- 13 миллион активных пользователей в месяц
- 2 миллиона активных пользователей в день 
- 34 минут - средное время который пользователи тратят в день
>
- 57 миллион пользователей
- 4.1 миллион Tinder Plus and Tinder Gold
- 30+ миллиард матчей c момента начало проекта (2012)
- 1.6 миллион матчей каждый день 

## 3. Выбор планируемой нагрузки 

В качестве нагрузки планируеться нагрузка как у Tinder-а но только для России. Если посчитать `RPS` 
```
2 000 0000 миллион активных пользователей
x
34 минут
/
24 часа x 60 минут
------------------------------------------
~ 47 000 RPS
``` 

## 4. Логическая схема базы данных (без выбора СУБД)

- > Users
	- ID
	- name 
	- birthday
	- bio
	- university
	- city
	- geo
	- description
	- accountID
	- interestedOn 
		- men
		- women
	- ageRange
	- maxDistance
	- isActive

- > Account 
	- ID 
	- email
	- phone 
	- password
	- lastSignIn

- > Likes 
	- ID
	- userFromID
	- userToID
	- like 
		- like (1)
		- dislike (-1) 

- > Session
	- ID
	- userID
	- session

- > Messages 
	- ID
	- userFromID
	- userToID
	- message
	
- > media
    - id
    - userID
    - url
    
## 5. Физическая системы хранения 
### (конкретные СУБД, шардинг, расчет нагрузки, обоснование реализуемости на основе результатов нагрузочного тестирования)

- Общая информация (аккаунт, сообщении, лайки) на PostgreSQL
- Информация о геоданных пользователей PostgreSQL с PostGis
- Сессии на Redis

Будем использовать горизонтальный шардинг для таблици `media` и `likes` так как основная нагрузка выпадает на них. У одного пользователья может быть куча лайков
и дизлайков в день. Также обычно пользователи вкладывають по 5-10 фото(видео) на свой аккаунт что довольно таки много 

## 6. Выбор прочих технологий: языки программирования, фреймфорки, протоколы взаимодействия, веб-сервера и т.д.

- >Языки программирования:
    - Так как приложение будет Mobile First необходимо написать приложение на нативном языке мобильных платформ а не на кроссплатформенных
     для Android-а это Java. А для IOS Swift
    - Будет также веб-версия продукта как SPA на Vue.js 
    - Бэк будет служит нам как REST API сервер. Язык программирование Go (высокая скорость, легка разработка паралельных приложений)
    - Библиотеки машинного обучение для систем рекомендации TensorRec (Python), Recombee (Есть для разных языков,но скорее всего pyhton)


- >Протоколы взаимодействия:
    - Для взаимодействия между микросервисами GRPC
    - Для взамимодействия между клиентамы и бэком HTTP 2


- >Веб сервера.
    - nginx для раздача статики 
    
- >Прочие технологии
    - imagemagick и Jpegtran для отрезки лишных метаданных о фотографии
    - Для конвертации из JPEG, PNG и TIFF на Webp используется утилита cwebp, а для декодирования — dwebp 

## 7. Расчет нагрузки и потребного оборудования

- *Фронтенд:*
    - 64ГБ памяти 32 ядра 32ГБ SSD без RAID
    - У нас фотографий может быть много и нагрузка на них тоже. Соответственно выбыраем побольше: 20
 
- *Бэкенд:*
    - 8Гб + (32ГБ для Redis) памят 32 ядра без RAID. 32ГБ SSD  
    - Штук 10

- *БД:*
    - 64Гб памят 32 ядра 2x256Гб SSD RAID
    - Штук 10

- *Сборщики статиски:*
    - 64Гб памят 32 ядра 512Гб SSD без RAID 
    - Штук 4
    
- *Балансировщик нагрузки:*
    - 8Гб памят 32 ядра без RAID. 32ГБ SSD
    - Штук 2 

## 8. Выбор хостинга / облачного провайдера и расположения серверов

Будем использовать Vscale.io. Расположение серверов - Москва
Память: 2ГБ, Диск (SSD): 40ГБ

## 9. Схема балансировки нагрузки (входящего трафика и внутрипроектного, терминация SSL)

- >Серверы разделены на текущие урлы
    - Фронтенды
    - Бэкенды 
    - БД
    - Балансировщик нагрузок
    - Система мониторингов

Для балансировщик нагрузки будем использовать Nginx L7. Терминация SSL будет проводит сам nginx

## 10. Обеспечение отказоустойчивости

- Для обеспечение отказоустойчивости надо обязательно на каждом сервере БД иметь репликацию (`Master-Slave`). При выходе из строя какого либо  Управление 
репликациями осуществляется `Stolon`-ом
- А также максимальное количество данных (статистки) о сервера. Система сбора статистики (`prometheus` + плагины для сбора информации на приимере `node_exporter`) +
система мониторинга и показ статистик - `grafana` 

### Links

[50 Interesting tinder Statistics and Facts (December 2018)](https://expandedramblings.com/index.php/tinder-statistics/amp/)


